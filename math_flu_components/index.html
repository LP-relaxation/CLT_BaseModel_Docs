
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../math_transitions/">
      
      
      <link rel="icon" href="../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.44">
    
    
      
        <title>Flu Model Mathematical Formulation - CLT Base Model</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.0253249f.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#flu-model-mathematical-formulation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="CLT Base Model" class="md-header__button md-logo" aria-label="CLT Base Model" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CLT Base Model
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Flu Model Mathematical Formulation
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="CLT Base Model" class="md-nav__button md-logo" aria-label="CLT Base Model" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    CLT Base Model
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Mathematical Formulation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Mathematical Formulation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Flu Model Mathematical Formulation
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Flu Model Mathematical Formulation
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#flu-model-diagram" class="md-nav__link">
    <span class="md-ellipsis">
      Flu model: diagram
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flu-model-deterministic-differential-equations" class="md-nav__link">
    <span class="md-ellipsis">
      Flu model: deterministic differential equations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flu-model-travel-model" class="md-nav__link">
    <span class="md-ellipsis">
      Flu model: travel model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flu-model-discretized-stochastic-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Flu model: discretized stochastic implementation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#general-model-discretized-stochastic-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      General model: discretized stochastic implementation
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../math_transitions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Stochastic Transitions
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Flu Model Code Documentation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Flu Model Code Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../flu_model_code_overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flu Model Code Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../flu_model_demo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flu Model Demo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../flu_input_requirements/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flu Model Input Requirements
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../flu_components_walkthrough/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flu Model Creation Walkthrough
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Code API Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Code API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../base_components_reference/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Base Components Code API Reference
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../flu_components_reference/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flu Components Code API Reference
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#flu-model-diagram" class="md-nav__link">
    <span class="md-ellipsis">
      Flu model: diagram
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flu-model-deterministic-differential-equations" class="md-nav__link">
    <span class="md-ellipsis">
      Flu model: deterministic differential equations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flu-model-travel-model" class="md-nav__link">
    <span class="md-ellipsis">
      Flu model: travel model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flu-model-discretized-stochastic-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Flu model: discretized stochastic implementation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#general-model-discretized-stochastic-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      General model: discretized stochastic implementation
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="flu-model-mathematical-formulation">Flu Model Mathematical Formulation</h1>
<p><span style="display: none;">
<span class="arithmatex">\(\def\rateRtoS{\sigma^{R\rightarrow S}}\)</span>
<span class="arithmatex">\(\def\rateEtoI{\sigma^{E \rightarrow [IP, IA]}}\)</span>
<span class="arithmatex">\(\def\rateIPtoIS{\sigma^{IP \rightarrow IS}}\)</span>
<span class="arithmatex">\(\def\rateIStoH{\sigma^{IS\rightarrow H}}\)</span>
<span class="arithmatex">\(\def\rateHtoD{\sigma^{H\rightarrow D}}\)</span>
<span class="arithmatex">\(\def\rateIAtoR{\gamma^{IA\rightarrow R}}\)</span>
<span class="arithmatex">\(\def\rateHtoR{\gamma^{H\rightarrow R}}\)</span>
<span class="arithmatex">\(\def\rateIStoR{\gamma^{IS\rightarrow R}}\)</span>
<span class="arithmatex">\(\def\totalforceofinfection{\lambda^{(\ell), \text{total}}_{a,r}(t)}\)</span>
<span class="arithmatex">\(\def\propIA{\pi^{IA}}\)</span>
<span class="arithmatex">\(\def\propH{\pi^H}\)</span>
<span class="arithmatex">\(\def\propD{\pi^D}\)</span>
<span class="arithmatex">\(\def\adjustedpropH{\tilde{\pi}^H}\)</span>
<span class="arithmatex">\(\def\adjustedpropD{\tilde{\pi}^D}\)</span>
<span class="arithmatex">\(\def\proptravelelltok{v^{\ell \rightarrow k}}\)</span>
<span class="arithmatex">\(\def\proptravelktoell{v^{k \rightarrow \ell}}\)</span>
<span class="arithmatex">\(\def\LambdaIIlocagerisktime{\Lambda^{(\ell), I, I}_{a,r}(t)}\)</span>
<span class="arithmatex">\(\def\LambdaHHlocagerisktime{\Lambda^{(\ell), H, H}_{a,r}(t)}\)</span>
<span class="arithmatex">\(\def\LambdaDHlocagerisktime{\Lambda^{(\ell), D, H}_{a,r}(t)}\)</span>
<span class="arithmatex">\(\def\locagerisk{^{(\ell)}_{a, r}}\)</span>
<span class="arithmatex">\(\def\locagerisktime{\locagerisk(t)}\)</span>
<span class="arithmatex">\(\def\locationell{^{(\ell)}}\)</span>
<span class="arithmatex">\(\def\locationk{^{(k)}}\)</span>
<span class="arithmatex">\(\def\agerisk{_{a, r}}\)</span>
<span class="arithmatex">\(\def\agerisktime{_{a, r}(t)}\)</span>
<span class="arithmatex">\(\def\ageprimeriskprime{_{a^\prime, r^\prime}}\)</span>
<span class="arithmatex">\(\def\locageprimeriskprime{^{(\ell)}_{a^\prime, r^\prime}}\)</span>
<span class="arithmatex">\(\def\Nlocagerisk{N^{(\ell)}_{a,r}}\)</span>
<span class="arithmatex">\(\def\effectiveNlocagerisktime{\tilde{N}^{(\ell)}_{a,r}(t)}\)</span>
<span class="arithmatex">\(\def\effectiveNlocageprimeriskprimetime{\tilde{N}^{(\ell)}_{a^\prime,r^\prime}(t)}\)</span>
<span class="arithmatex">\(\def\multipliertravel{h_{\text{travel}}}\)</span>
<span class="arithmatex">\(\def\multipliersymptom{h_{\text{symp}}}\)</span>
<span class="arithmatex">\(\def\tvarloc{y^{(\ell)}}\)</span>
<span class="arithmatex">\(\def\jointtvarloc{y^{(\ell) *}}\)</span>
<span class="arithmatex">\(\def\simstate{\boldsymbol{\Xi}_t}\)</span>
<span class="arithmatex">\(\def\agegroups{\mathcal A}\)</span>
<span class="arithmatex">\(\def\riskgroups{\mathcal R}\)</span>
<span class="arithmatex">\(\def\numagegroups{\lvert \agegroups \rvert}\)</span>
<span class="arithmatex">\(\def\numriskgroups{\lvert \riskgroups \rvert}\)</span>
</span></p>
<blockquote>
<p><strong><em>Updated 01/10/2025 (work in progress)</em></strong></p>
<p><strong><em>Written by LP. Travel model formulated by Remy.</em></strong> </p>
<p><strong><em>Important notes: we are updating this page to include wastewater viral load (from Sonny) -- check back soon. Also, please report any typos!</em></strong></p>
</blockquote>
<h2 id="flu-model-diagram">Flu model: diagram</h2>
<p><img alt="flu_model_diagram" src="../figs/flu_model_diagram.png" /></p>
<h2 id="flu-model-deterministic-differential-equations">Flu model: deterministic differential equations</h2>
<ul>
<li><span class="arithmatex">\(t \in \mathbb N\)</span>: current simulation day</li>
<li><span class="arithmatex">\(\ell\)</span>: location, i.e. subpopulation, <span class="arithmatex">\(\mathcal L\)</span>: set of all locations/subpopulations</li>
<li><span class="arithmatex">\(a\)</span>: age group, <span class="arithmatex">\(\agegroups\)</span>: set of all age groups</li>
<li><span class="arithmatex">\(r\)</span>: risk group, <span class="arithmatex">\(\riskgroups\)</span>: set of all risk groups</li>
<li><span class="arithmatex">\(i\)</span>: type of immunity-inducing event, <span class="arithmatex">\(\mathcal{I} := \left\{\text{H1}, \text{H3}, \text{V}\right\}\)</span>: the set of all types of immunity-inducing events: infection by H1N1, infection by H3N2, and vaccination, respectively.</li>
<li><span class="arithmatex">\(\boldsymbol{O}\)</span>: <span class="arithmatex">\(\numagegroups \times \numriskgroups \times \lvert \mathcal{I} \rvert\)</span> matrix, where the <span class="arithmatex">\((a, r, i)\)</span>th element is the positive constant modeling the saturation of antibody production in individuals in age group <span class="arithmatex">\(a\)</span> and risk group <span class="arithmatex">\(r\)</span> who had immunity-inducing event <span class="arithmatex">\(i\)</span>.</li>
</ul>
<p><strong>Population-level immunity against <em>infection</em> (derived from H1N1 infections, H3N2 infections, and vaccinations respectively)</strong></p>
<p>For each <span class="arithmatex">\(\ell \in \mathcal L\)</span>, <span class="arithmatex">\(a \in \agegroups\)</span>, <span class="arithmatex">\(r \in \riskgroups\)</span>:</p>
<div class="arithmatex">\[\begin{align*}
\frac{dM^{(\ell), I}_{a, r, H1}(t)}{dt} &amp;= \frac{g^I_{H1} p_{H1}(t) \rateRtoS(t) R\locagerisktime}{N\locagerisk \left(1 + \sum_{i \in \mathcal I} O_{a, r, i} M^{(\ell), I}_{a, r, i}(t)\right)} - w^I_{H1} M^{(\ell), I}_{a, r, H1}(t) \\
\frac{dM^{(\ell), I}_{a, r, H3}(t)}{dt} &amp;= \frac{g^I_{H3} p_{H3}(t) \rateRtoS(t) R\locagerisktime}{N\locagerisk \left(1 + \sum_{i \in \mathcal I} O_{a, r, i} M^{(\ell), I}_{a, r, i}(t)\right)} - w^I_{H3} M^{(\ell), I}_{a, r, H3}(t) \\
\frac{dM^{(\ell), I}_{a, r, V}(t)}{dt} &amp;= g^I_V V(t - \delta) - w^I_V M^{(\ell), I}_{a, r, V}(t).
\end{align*}\]</div>
<p>where</p>
<ul>
<li><span class="arithmatex">\(\rateRtoS\)</span>: rate at which recovered individuals become susceptible, so that <span class="arithmatex">\(1/\rateRtoS\)</span> is the average number of days a person is totally immune from reinfection until being susceptible again.</li>
<li><span class="arithmatex">\(\boldsymbol{N}^{(\ell)}\)</span>: <span class="arithmatex">\(\numagegroups \times \numriskgroups\)</span> matrix corresponding to total population in location <span class="arithmatex">\(\ell \in \mathcal L\)</span>, where element <span class="arithmatex">\(N\locagerisk\)</span> is the total population of age group <span class="arithmatex">\(a\)</span> and risk group <span class="arithmatex">\(\ell\)</span> in location <span class="arithmatex">\(\ell\)</span>.</li>
<li><span class="arithmatex">\(V^{(\ell)}(t)\)</span>: number of vaccine doses administered at time <span class="arithmatex">\(t\)</span> to individuals residing in location <span class="arithmatex">\(\ell \in \mathcal L\)</span>.</li>
<li><span class="arithmatex">\(\boldsymbol{p} = \boldsymbol{p}(t) = [p_{H1}(t)\)</span>, <span class="arithmatex">\(p_{H3}(t)]\)</span>: where elements correspond to prevalence of H1N1, H3N2 respectively.</li>
<li><span class="arithmatex">\(\delta\)</span>: number of days after dose for vaccine to become effective.</li>
<li><span class="arithmatex">\(g^I_{H1}\)</span>: factor by which population-level immunity against infection grows after each H1N1 case that recovers.</li>
<li><span class="arithmatex">\(g^I_{H3}\)</span>: factor by which population-level immunity against infection grows after each H3N2 case that recovers.</li>
<li><span class="arithmatex">\(g^I_V\)</span>: factor by which population-level immunity against infection grows after each vaccination.</li>
<li><span class="arithmatex">\(w^I_{H1}\)</span>: rate at which H1N1 infection-induced immunity against infection wanes.</li>
<li><span class="arithmatex">\(w^I_{H3}\)</span>: rate at which H3N2 infection-induced immunity against infection wanes.</li>
<li><span class="arithmatex">\(w^I_V\)</span>: rate at which vaccine-induced immunity against infection wanes.</li>
</ul>
<p><strong>Population-level immunity against <em>hospitalization</em> (derived from H1N1 infections, H3N2 infections, and vaccinations respectively)</strong></p>
<p>For each <span class="arithmatex">\(\ell \in \mathcal L\)</span>, <span class="arithmatex">\(a \in \agegroups\)</span>, <span class="arithmatex">\(r \in \riskgroups\)</span>:</p>
<div class="arithmatex">\[\begin{align}
\frac{dM^{(\ell), H}_{a, r, H1}(t)}{dt} &amp;= \frac{g^H_{H1} p_{H1}(t) \rateRtoS(t) R\locagerisktime}{N\locagerisk \left(1 + \sum_{i \in \mathcal I} O_{a, r, i} M^{(\ell), H}_{a, r, i}(t)\right)} - w^H_{H1} M^{(\ell), H}_{a, r, H1}(t) \\
\frac{dM^{(\ell), H}_{a, r, H3}(t)}{dt} &amp;= \frac{g^H_{H3} p_{H3}(t) \rateRtoS(t) R\locagerisktime}{N\locagerisk \left(1 + \sum_{i \in \mathcal I} O_{a, r, i} M^{(\ell), H}_{a, r, i}(t)\right)} - w^H_{H3} M^{(\ell), H}_{a, r, H3}(t) \\
\frac{dM^{(\ell), H}_{a, r, V}(t)}{dt} &amp;= g^H_V V(t - \delta) - w^H_V M^{(\ell), H}_{a, r, V}(t).
\end{align}\]</div>
<p>where</p>
<ul>
<li><span class="arithmatex">\(\rateRtoS\)</span>, <span class="arithmatex">\(\boldsymbol{N}^{(\ell)}\)</span>, <span class="arithmatex">\(p_{H1}(t)\)</span>, <span class="arithmatex">\(p_{H3}(t)\)</span>, <span class="arithmatex">\(V^{(\ell)}(t)\)</span>, <span class="arithmatex">\(\delta\)</span>: see above.</li>
<li><span class="arithmatex">\(g^H_{H1}\)</span>: factor by which population-level immunity against hospitalization grows after each H1N1 case that recovers.</li>
<li><span class="arithmatex">\(g^H_{H3}\)</span>: factor by which population-level immunity against hospitalization grows after each H3N2 case that recovers.</li>
<li><span class="arithmatex">\(g^H_V\)</span>: factor by which population-level immunity against hospitalization grows after each vaccination.</li>
<li><span class="arithmatex">\(w^H_{H1}\)</span>: rate at which H1N1 infection-induced immunity against hospitalization wanes.</li>
<li><span class="arithmatex">\(w^H_{H3}\)</span>: rate at which H3N2 infection-induced immunity against hospitalization wanes.</li>
<li><span class="arithmatex">\(w^H_V\)</span>: rate at which vaccine-induced immunity against hospitalization wanes.</li>
</ul>
<p><strong>Compartment equations</strong></p>
<p>Note: the <span class="arithmatex">\(\lambda\)</span>-terms are location/subpopulation mixing terms that we define in the next section on the travel model. </p>
<p>For each <span class="arithmatex">\(\ell \in \mathcal L\)</span>, <span class="arithmatex">\(a \in \agegroups\)</span>, <span class="arithmatex">\(r \in \riskgroups\)</span>:</p>
<div class="arithmatex">\[\begin{align}
\frac{dS\locagerisktime}{dt} &amp;= \underbrace{\rateRtoS R\locagerisktime}_{\text{$R$ to $S$}} 
-\underbrace{S\locagerisktime \totalforceofinfection}_{\text{$S$ to $E$}} \\[1.5em]
\frac{dE\locagerisktime}{dt} &amp;= \underbrace{S\locagerisktime \totalforceofinfection}_{\text{$S$ to $E$}} 
- \underbrace{\rateEtoI (1-\propIA) E\locagerisktime}_{\text{$E$ to $IP$}} 
- \underbrace{\rateEtoI \propIA E\locagerisktime}_{\text{$E$ to $IA$}} \\[1.5em]
\frac{dIP\locagerisktime}{dt} &amp;= \underbrace{\rateEtoI (1-\propIA) E\locagerisktime}_{\text{$E$ to $IP$}} 
- \underbrace{\rateIPtoIS IP\locagerisktime}_{\text{$IP$ to $IS$}} \\[1.5em]
\frac{dIS\locagerisktime}{dt} &amp;= \underbrace{\rateIPtoIS IP\locagerisktime}_{\text{$IP$ to $IS$}} 
- \underbrace{(1-\adjustedpropH_{a, r})\rateIStoR IS\locagerisktime}_{\text{$IS$ to $R$}} 
- \underbrace{\frac{\rateIStoH \adjustedpropH_{a, r} IS\locagerisktime}{1 + \LambdaHHlocagerisktime}}_{\text{$IS$ to $H$}} \\[1.5em]
\frac{dIA\locagerisktime}{dt} &amp;= \underbrace{\rateEtoI \propIA E\locagerisktime}_{\text{$E$ to $IA$}} 
- \underbrace{\rateIAtoR IA\locagerisktime}_{\text{$IA$ to $R$}} \\[1.5em]
\frac{dH\locagerisktime}{dt} &amp;= \underbrace{\frac{\rateIStoH \adjustedpropH_{a, r} IS\locagerisktime}{1 + \LambdaHHlocagerisktime}}_{\text{$IS$ to $H$}} 
- \underbrace{(1-\adjustedpropD_{a, r})\rateHtoR H\locagerisktime}_{\text{$H$ to $R$}} 
- \underbrace{\frac{\rateHtoD \adjustedpropD_{a, r} H\locagerisktime}{1 + \LambdaHHlocagerisktime}}_{\text{$H$ to $D$}} \\[1.5em]
\frac{dR\locagerisktime}{dt} &amp;= \underbrace{(1-\adjustedpropH_{a, r}) \rateIStoR IS\locagerisktime}_{\text{$IS$ to $R$}} 
+ \underbrace{\rateIAtoR IA\locagerisktime}_{\text{$IA$ to $R$}} 
+ \underbrace{(1-\adjustedpropD_{a, r})\rateHtoR H\locagerisktime}_{\text{$H$ to $R$}} \\[1em] &amp;\quad\quad\quad
- \underbrace{\rateRtoS R\locagerisktime}_{\text{$R$ to $S$}} \\[1.5em]
\frac{dD\locagerisktime}{dt} &amp;= \underbrace{\frac{\rateHtoD \adjustedpropD_{a, r} H\locagerisktime}{1 + \LambdaDHlocagerisktime}}_{\text{$H$ to $D$}}. 
\end{align}\]</div>
<p>We have the following terms that characterize the effect of population-level immunities:</p>
<div class="arithmatex">\[\begin{align}
\LambdaIIlocagerisktime &amp;= \left[K_{a,r}^{I}(p(t))\right]^T M_{a,r}^{(\ell), I}(t) \\
\LambdaHHlocagerisktime &amp;= \left[K_{a,r}^{H}(p(t))\right]^T M_{a,r}^{(\ell), H}(t) \\
\LambdaDHlocagerisktime &amp;= \left[K_{a,r}^{D}(p(t))\right]^T M_{a,r}^{(\ell), H}(t)
\end{align}\]</div>
<p>and where</p>
<ul>
<li><span class="arithmatex">\(\propIA\)</span>: proportion exposed who are completely asymptomatic when infectious.</li>
<li><span class="arithmatex">\(r_{IP}\)</span>, <span class="arithmatex">\(r_{IA}\)</span>: relative infectiousness (compared to infected symptomatic people) of infected presymptomatic and infected asymptomatic people respectively. </li>
<li><span class="arithmatex">\(\rateIStoR, \rateHtoR, \rateIAtoR\)</span>: recovery rates for infected symptomatic (<span class="arithmatex">\(IS\)</span>),  hospital (<span class="arithmatex">\(H\)</span>), and infected asymptomatic (<span class="arithmatex">\(IA\)</span>) compartments respectively, so that <span class="arithmatex">\(1/\gamma\)</span> is the average number of days it takes for an infected person not in the hospital to recover, and <span class="arithmatex">\(1/\rateHtoR\)</span> is analogous, but for an infected person in the hospital. </li>
<li><span class="arithmatex">\(\rateEtoI\)</span>: infection rate (both exposed to infected presymptomatic transition rate and exposed to infected asymptomatic transition rate), so that <span class="arithmatex">\(1/\rateEtoI\)</span> is the average number of days after exposure before a person becomes infectious.</li>
<li><span class="arithmatex">\(\rateIPtoIS\)</span>: infected presymptomatic to infected symptomatic transition rate, so that <span class="arithmatex">\(1/\rateIPtoIS\)</span> is the average number of days that an infected person is presymptomatic before becoming symptomatic. </li>
<li><span class="arithmatex">\(\rateIStoH\)</span>: hospitalization rate (infected to hospital transition rate), so that <span class="arithmatex">\(1/\rateIStoH\)</span> is the average number of days a person is infected before going to the hospital.</li>
<li><span class="arithmatex">\(\rateHtoD\)</span>: death rate from hospital, so that <span class="arithmatex">\(1/\rateHtoD\)</span> is the average number of days a person spends in the hospital before dying.</li>
<li><span class="arithmatex">\(\boldsymbol{\adjustedpropH}\)</span>, where <span class="arithmatex">\(\adjustedpropH_{a, r} = \frac{\propH_{a, r}\gamma}{\rateIStoH - \propH_{a, r}(\rateIStoH-\rateIStoR)}\)</span>: adjusted proportion hospitalized based on age-risk group <span class="arithmatex">\(a, r\)</span> group actually used in model -- this adjustment is necessary to ensure actual proportion hospitalized recapitulates <span class="arithmatex">\([\propH_{a, r}]\)</span>.</li>
<li><span class="arithmatex">\(\boldsymbol{\propH}\)</span>: <span class="arithmatex">\(\numagegroups \times \numriskgroups\)</span> proportion hospitalized based on age-risk group <span class="arithmatex">\(a, r\)</span>.</li>
<li><span class="arithmatex">\(\boldsymbol{\adjustedpropD}\)</span>, where <span class="arithmatex">\(\adjustedpropD_{a, r} = \frac{\propD_{a, r} \rateHtoR}{\rateHtoD - \propD_{a, r} (\rateIStoH-\rateHtoR)}\)</span>: adjusted in-hospital mortality rate (as in, proportion who die in the hospital based on age group) actually used in model -- this adjustment is necessary to ensure actual proportion who die in the hospital recapitulates <span class="arithmatex">\([\propD_{a, r} ]\)</span>.</li>
<li><span class="arithmatex">\(\boldsymbol{\propD}\)</span>: <span class="arithmatex">\(\numagegroups \times \numriskgroups\)</span> in-hospital mortality rate (proportion who die based on age-risk group <span class="arithmatex">\(a, r\)</span>).</li>
</ul>
<p>Note that the following are all <span class="arithmatex">\(\numagegroups \times \numriskgroups \times \lvert \mathcal I \rvert\)</span> matrices:</p>
<ul>
<li><strong><span class="arithmatex">\(\boldsymbol{K}^I(\boldsymbol{p}) = [\boldsymbol{K}^I_{H1}(p_{H1}), \boldsymbol{K}^I_{H3}(p_{H3}), \boldsymbol{K}^I_{V}]\)</span></strong>: reduction in infection risk from given immunity-inducing event.  </li>
<li><strong><span class="arithmatex">\(\boldsymbol{K}^{H}(\boldsymbol{p}) = [\boldsymbol{K}^H_{H1}(p_{H1}), \boldsymbol{K}^H_{H3}(p_{H3}), \boldsymbol{K}^H_{V}]\)</span></strong>: reduction in hospitalization risk from given immunity-inducing event.  </li>
<li><strong><span class="arithmatex">\(\boldsymbol{K}^D(\boldsymbol{p}) = [\boldsymbol{K}^D_{H1}(p_{H1}), \boldsymbol{K^D}_{H3}(p_{H3}), \boldsymbol{K}^D_{V}]\)</span></strong>: reduction in death risk from given immunity-inducing event.  </li>
<li><strong><span class="arithmatex">\(\boldsymbol{M}^{(\ell), I} = \boldsymbol{M}^{(\ell), I}(t) = [\boldsymbol{M}^{(\ell), I}_{H1}(t), \boldsymbol{M}^{(\ell), I}_{H3}(t), \boldsymbol{M}^{(\ell), I}_{V}(t)]\)</span></strong>: location <span class="arithmatex">\(\ell \in \mathcal L\)</span> population-level immunity from infection (induced by H1 infection, H3 infection, vaccination respectively).  </li>
<li><strong><span class="arithmatex">\(\boldsymbol{M}^{(\ell), H} = \boldsymbol{M}^{(\ell), H}(t) = [\boldsymbol{M}^{(\ell), H}_{H1}(t), \boldsymbol{M}^{(\ell), H}_{H3}(t), \boldsymbol{M}^{(\ell), H}_{V}(t)]\)</span></strong>: location <span class="arithmatex">\(\ell \in \mathcal L\)</span> population-level immunity from hospitalization (induced by H1 infection, H3 infection, vaccination respectively).</li>
</ul>
<p>Note that prevalence is time-dependent, but we use <span class="arithmatex">\(\boldsymbol{p} = \boldsymbol{p}(t)\)</span> for notation simplicity. </p>
<h2 id="flu-model-travel-model">Flu model: travel model</h2>
<p>For each <span class="arithmatex">\(\ell \in \mathcal L\)</span>, <span class="arithmatex">\(a \in \agegroups\)</span>, <span class="arithmatex">\(r \in \riskgroups\)</span>, we have</p>
<div class="arithmatex">\[\begin{align*}
\totalforceofinfection &amp;= \lambda^{\ell \rightarrow \ell}_{a, r}(t) + \sum_{k \in \mathcal L \setminus \{\ell\}} \left(\lambda^{k \rightarrow \ell}_{a, r}(t) + \lambda^{\ell \rightarrow k}_{a, r}(t)\right) \\[1.5em]
\lambda^{\ell \rightarrow \ell}_{a, r}(t) &amp;= \frac{\beta^{(\ell)}(t) \cdot \psi_a}{\left(1 + \LambdaIIlocagerisktime\right)} \left(1 - c_a \sum_{k \in \mathcal L \setminus \{\ell\}} \proptravelelltok \right) \\ &amp;\quad\quad\quad \cdot \sum \limits_{a^\prime \in \agegroups} \phi^{(\ell)}_{a,a^\prime}(t) \frac{\sum_{r^\prime \in \riskgroups} \left[IS\locageprimeriskprime(t) + r_{IP} IP\locageprimeriskprime(t) + r_{IA} IA\locageprimeriskprime(t)\right]}{\sum_{r^\prime \in \riskgroups} \effectiveNlocageprimeriskprimetime} \\[1.5em]
\lambda_{a,r}^{k \rightarrow \ell}(t) &amp;= \frac{\beta^{(\ell)}(t) \cdot \psi_a \cdot \multipliertravel}{\left(1 + \LambdaIIlocagerisktime\right)} \cdot \proptravelktoell \\ &amp;\quad \cdot \sum\limits_{a^\prime \in \agegroups} c_{a^\prime} \cdot \phi^{(\ell)}_{a, a^\prime}(t) \frac{\sum_{r^\prime \in \riskgroups}\left[\multipliersymptom IS\locationk\ageprimeriskprime(t) + r_{IP} IP\locationk\ageprimeriskprime(t) + r_{IA} IA\locationk\ageprimeriskprime(t)\right]}{\sum_{r^\prime \in \riskgroups} \effectiveNlocageprimeriskprimetime} \\[1.5em]
\lambda_{a,r}^{\ell \rightarrow k}(t) &amp;= \frac{\beta^{(\ell)}(t) \cdot \psi_a \cdot \multipliertravel}{{\left(1 + \LambdaIIlocagerisktime\right)}} \cdot  \proptravelelltok  \cdot c_a \\ &amp;\quad\quad\quad \cdot \sum\limits_{a^\prime \in \agegroups} \phi^{(\ell)}_{a, a^\prime}(t) \frac{\sum_{r^\prime \in \riskgroups} \left[IS\locationk\ageprimeriskprime(t) + r_{IP} IP\locationk\ageprimeriskprime(t) + r_{IA} IA\locationk\ageprimeriskprime(t)\right]}{\sum_{r^\prime \in \riskgroups} \tilde{N}^{(k)}_{a^\prime, r^\prime} (t)}
\end{align*}\]</div>
<p>where</p>
<div class="arithmatex">\[\begin{align*}
\effectiveNlocagerisktime &amp;= \Nlocagerisk + c_a \cdot \sum_{k \in \mathcal L \setminus \{\ell\}} \proptravelktoell \cdot (N^{(k)}_{a, r} - (1-\multipliersymptom) IS^{(k)}_{a,r}(t) - H^{(k)}_{a,r}(t)) \\ &amp;\quad\quad\quad - c_a \cdot \sum_{k \in \mathcal L \setminus \{\ell\}} \proptravelelltok  \cdot (N\locagerisk - (1-\multipliersymptom) IS\locagerisktime - H^{(\ell)}_{a,r}(t))
\end{align*}\]</div>
<p>is the effective population in location <span class="arithmatex">\(\ell \in \mathcal L\)</span> and age-risk group <span class="arithmatex">\(a \in \agegroups\)</span>, <span class="arithmatex">\(r \in \riskgroups\)</span> at time <span class="arithmatex">\(t\)</span>, and where</p>
<ul>
<li><span class="arithmatex">\(\beta^{(\ell)}(t) = \beta^{(\ell)}_0 (1 + q(t))\)</span>: time-dependent transmission rate per day for individuals residing in location <span class="arithmatex">\(\ell \in \mathcal L\)</span>.</li>
<li><span class="arithmatex">\(q(t)\)</span>: seasonality parameter based on absolute humidity, where <span class="arithmatex">\(q(t)\)</span> is a function of historical absolute humidity data times <span class="arithmatex">\(\xi\)</span>, a humidity impact factor.</li>
<li><span class="arithmatex">\(\phi_{a, a^\prime}^{(\ell)}(t)\)</span>: the number of contacts that individuals in age group <span class="arithmatex">\(a \in \agegroups\)</span> residing in location <span class="arithmatex">\(\ell \in \mathcal L\)</span> have with other individuals (regardless of location) in age group <span class="arithmatex">\(a^\prime \in \agegroups\)</span>. </li>
<li><span class="arithmatex">\(\psi_a \in [0, 1]\)</span>: relative susceptibility of individuals in age group <span class="arithmatex">\(a \in \agegroups\)</span>.</li>
<li><span class="arithmatex">\(\proptravelktoell\)</span>: proportion of population in location <span class="arithmatex">\(k \in \mathcal L\)</span> that travels to location <span class="arithmatex">\(\ell \in \mathcal L\)</span>.</li>
<li><span class="arithmatex">\(c_a\)</span>: proportion of time individuals in age group <span class="arithmatex">\(a \in \agegroups\)</span> spend away from home region when traveling. </li>
<li><span class="arithmatex">\(\multipliertravel \in [0,1]\)</span>: multiplier to reduce contact rate of traveling individuals. </li>
<li><span class="arithmatex">\(\multipliersymptom \in [0,1]\)</span>: multiplier to reduce contact rate of symptomatic individuals.</li>
</ul>
<p>Note that the decompositions model the following phenomenon:</p>
<ul>
<li><span class="arithmatex">\(\lambda^{k \rightarrow \ell}\agerisktime\)</span>: rate at which individuals in location <span class="arithmatex">\(\ell\)</span> get exposed to infected people who live in location <span class="arithmatex">\(k\)</span> but travel to location <span class="arithmatex">\(\ell\)</span> (note: this contact occurs in location <span class="arithmatex">\(\ell\)</span>).</li>
<li><span class="arithmatex">\(\lambda^{\ell \rightarrow k}\agerisktime\)</span>: rate at which individuals in location <span class="arithmatex">\(\ell\)</span> get exposed to infected people who live in location <span class="arithmatex">\(k\)</span>, due to individuals who live in location <span class="arithmatex">\(\ell\)</span> traveling to location <span class="arithmatex">\(k\)</span> (note: this contact occurs in location <span class="arithmatex">\(k\)</span>).</li>
</ul>
<h2 id="flu-model-discretized-stochastic-implementation">Flu model: discretized stochastic implementation</h2>
<p>To actually implement/simulate this compartmental model, we discretize the deterministic differential equations and treat transitions between compartments as stochastic to model uncertainty. We extend the notation from the deterministic differential equations to capture the stochastic elements.</p>
<p>Let <strong><span class="arithmatex">\(\boldsymbol{\mathcal X}(t) = \left\{\boldsymbol{S}(t), \boldsymbol{E}(t), \boldsymbol{I}(t), \boldsymbol{H}(t), \boldsymbol{R}(t), \boldsymbol{D}(t), \boldsymbol{M}^I(t), \boldsymbol{M}^H(t), q(t), \boldsymbol{\phi}(t), \boldsymbol{p}(t), V^{(\ell)}(t)\right\}\)</span></strong> be the "simulate state" at time <span class="arithmatex">\(t\)</span>. <strong><span class="arithmatex">\(\boldsymbol{\mathcal X}(t)\)</span></strong> is a set of matrices. </p>
<p>Let <strong><span class="arithmatex">\(\boldsymbol{\Theta} = \left\{\boldsymbol{O}, \boldsymbol{N}, \boldsymbol{g}^I, \boldsymbol{w}^I, \boldsymbol{g}^H, \boldsymbol{w^H}, \beta_0, \gamma, \rateHtoR, \rateEtoI, \boldsymbol{\propH}, \rateIStoH, \boldsymbol{\propD}, \rateHtoD, \rateRtoS \right\}\)</span></strong> be the set of fixed parameters. We define notation <span class="arithmatex">\(\boldsymbol{g}^I = [g^I_{H1}, g^I_{H3}, g^I_V]\)</span>,  <span class="arithmatex">\(\boldsymbol{w}^I = [w^I_{H1}, w^I_{H3}, w^I_V]\)</span>, <span class="arithmatex">\(\boldsymbol{g}^H = [g^H_{H1}, g^H_{H3}, g^H_V]\)</span>, and <span class="arithmatex">\(\boldsymbol{w}^H = [w^H_{H1}, w^H_{H3}, w^H_V]\)</span>. </p>
<p>Then given initial state <span class="arithmatex">\(\boldsymbol{\mathcal X}_0 = \boldsymbol{\mathcal X}(0)\)</span>, we can formulate our discretized stochastic implementation as</p>
<div class="arithmatex">\[
\boldsymbol{\mathcal X}(t + \Delta t) = \boldsymbol{\mathcal X}(t) + f\left(\boldsymbol{\mathcal X}(t), \Delta t, \omega; \boldsymbol{\Theta}\right) \quad \text{for} \quad t \ge 0,
\]</div>
<p>where <span class="arithmatex">\(f\)</span> is parametrized by <span class="arithmatex">\(\boldsymbol{\Theta}\)</span>, and depends on the step size of discretization <span class="arithmatex">\(\Delta t\)</span> and a sample path <span class="arithmatex">\(\omega\)</span>. We assume that each sample path <span class="arithmatex">\(\omega\)</span> is realized from a random process that does not depend on <span class="arithmatex">\(\boldsymbol{\mathcal X}(t)\)</span> or <span class="arithmatex">\(\Delta t\)</span> for each <span class="arithmatex">\(t\)</span>. When we are discussing a single model with a fixed set of parameters <span class="arithmatex">\(\boldsymbol{\Theta}\)</span>, we drop the <span class="arithmatex">\(\boldsymbol{\Theta}\)</span> notation for simplicity.  </p>
<p>Now we formulate how we implement discretized stochastic transitions. We assume that <span class="arithmatex">\(q(t)\)</span>, <strong><span class="arithmatex">\(\boldsymbol{\phi}(t)\)</span></strong>, <strong><span class="arithmatex">\(\boldsymbol{p}(t)\)</span></strong>, and <span class="arithmatex">\(V^{(\ell)}(t)\)</span>  are updated deterministically according to some "schedule."  </p>
<p>We model stochastic transitions between compartments using "transition variables." Transition variables correspond to incoming and outgoing flows of epidemiological compartments (see the compartment equations above). </p>
<p>Below we formulate the discretized stochastic transitions. For brevity, we omit the update formulas for <span class="arithmatex">\(\boldsymbol{M}^H(t)\)</span> since it is analogous to the discretized update for <span class="arithmatex">\(\boldsymbol{M}^I(t)\)</span>. Note that the population-level immunity variables behave as aggregate epidemiological metrics. They are deterministic functions of the simulation state and transitions between compartments.</p>
<blockquote>
<p><strong>IMPORTANT NOTE_: all <span class="arithmatex">\(y\)</span> and <span class="arithmatex">\(y^*\)</span>-variables depend on <span class="arithmatex">\(\left(\boldsymbol{\mathcal X}(t), \Delta t, \omega\right)\)</span>. For notation simplicity, we define <span class="arithmatex">\(\simstate := \left(\boldsymbol{\mathcal X}(t), \Delta t, \omega\right)\)</span> and write <span class="arithmatex">\(y\)</span> and <span class="arithmatex">\(y^*\)</span>-variables as functions of <span class="arithmatex">\(\simstate\)</span>.</strong></p>
</blockquote>
<p>For each <span class="arithmatex">\(\ell \in \mathcal L\)</span>, <span class="arithmatex">\(a \in \agegroups\)</span>, and <span class="arithmatex">\(r \in \riskgroups\)</span>:</p>
<div class="arithmatex">\[\begin{align}
M_{a, r, H1}^{(\ell), I}(t + \Delta t) &amp;= M_{a, r, H1}^{(\ell), I}(t) + \left[\frac{g^I_{H1} p_{H1}(t) \cdot \overbrace{\tvarloc_{R\rightarrow S, a, r}(\Xi_t)}^{\text{$R$ to $S$}}}{N_{a,r} \left(1 + \sum_{i \in \mathcal I} O_{a,r, i} M^I_{a,r, i}(t)\right)} - w^I_{H1} M^I_{a,r,H1}(t)\right] \Delta t \\
M_{a, r, H3}^{(\ell), I}(t + \Delta t) &amp;= M_{a, r, H3}^{(\ell), I}(t) + \left[\frac{g^I_{H3} p_{H3}(t) \cdot \overbrace{\tvarloc_{R\rightarrow S, a, r}(\Xi_t)}^{\text{$R$ to $S$}}}{N_{a,r} \left(1 + \sum_{i \in \mathcal I} O_{a,r, i} M^I_{a,r, i}(t)\right)} - w^I_{H3} M^I_{a,r,H3}(t)\right] \Delta t \\
M_{a,r,V}^{(\ell), I}(t + \Delta t) &amp;= M_{a,r,V}^{(\ell), I}(t) + \left[g^I_V V(t - \delta) - w^I_V M^I_{a,r,V}(t)\right] \Delta t
\end{align}\]</div>
<div class="arithmatex">\[
\vdots
\]</div>
<div class="arithmatex">\[\begin{align}
S\locagerisk(t + \Delta t) &amp;= S_{a, r}^{(\ell)}(t) + \underbrace{\tvarloc_{R\rightarrow S, a, r}(\Xi_t)}_{\text{$R$ to $S$}} - \underbrace{\tvarloc_{S\rightarrow E, a, r}(\Xi_t)}_{\text{$S$ to $E$}} \\
E\locagerisk(t + \Delta t) &amp;= E_{a, r}^{(\ell)}(t) + \underbrace{\tvarloc_{S\rightarrow E, a, r}(\Xi_t)}_{\text{$S$ to $E$}} - \underbrace{\jointtvarloc_{E\rightarrow IP, a, r}(\Xi_t)}_{\text{$E$ to $IP$}} - \underbrace{\jointtvarloc_{E\rightarrow IA, a, r}(\Xi_t)}_{\text{$E$ to $IA$}} \\
IP\locagerisk(t + \Delta t) &amp;= IP\locagerisktime + \underbrace{\jointtvarloc_{E\rightarrow IP, a, r}(\Xi_t)}_{\text{$E$ to $IP$}} - \underbrace{\tvarloc_{IP \rightarrow IS, a, r}(\Xi_t)}_{\text{$IP$ to $IS$}} \\
IA_{a, r}^{(\ell)}(t + \Delta t) &amp;= IA_{a, r}^{(\ell)}(t) + \underbrace{\jointtvarloc_{E\rightarrow IA, a, r}(\Xi_t)}_{\text{$E$ to $IA$}} - \underbrace{\tvarloc_{IA \rightarrow R, a, r}(\Xi_t)}_{\text{$IA$ to $R$}} \\
IS\locagerisk(t + \Delta t) &amp;= IS_{a, r}^{(\ell)}(t) + \underbrace{\tvarloc_{E \rightarrow IS, a, r}(\Xi_t)}_{\text{$E$ to $IP$}} - \underbrace{\jointtvarloc_{IS \rightarrow R, a, r}(\Xi_t)}_{\text{$IS$ to $R$}} - \underbrace{\jointtvarloc_{IS \rightarrow H, a, r}(\Xi_t)}_{\text{$IS$ to $H$}} \\
H\locagerisk(t + \Delta t) &amp;= H_{a, r}^{(\ell)}(t) + \underbrace{\jointtvarloc_{IS \rightarrow H, a, r}(\Xi_t)}_{\text{$IS$ to $H$}} - \underbrace{\jointtvarloc_{H\rightarrow R, a, r}(\Xi_t)}_{\text{$H$ to $R$}} - \underbrace{\jointtvarloc_{H\rightarrow D, a, r}(\Xi_t)}_{\text{$H$ to $D$}} \\
R\locagerisk(t + \Delta t) &amp;= R_{a, r}^{(\ell)}(t) + \underbrace{\jointtvarloc_{IS \rightarrow R, a, r}(\Xi_t)}_{\text{$IS$ to $R$}} + \underbrace{\jointtvarloc_{H\rightarrow R, a, r}(\Xi_t)}_{\text{$H$ to $R$}} - \underbrace{\tvarloc_{R\rightarrow S, a, r}(\Xi_t)}_{\text{$R$ to $S$}} \\
D\locagerisk(t + \Delta t) &amp;= D_{a, r}^{(\ell)}(t) + \underbrace{\tvarloc_{H\rightarrow D, a, r}(\Xi_t)}_{\text{$H$ to $D$}}. 
\end{align}\]</div>
<blockquote>
<p><strong>IMPORTANT NOTE: the "<span class="arithmatex">\(*\)</span>" superscript indicates that the transition variable has a joint distribution with another transition variable. In general, if a compartment has more than one outgoing transition variable, these transition variables must be modeled jointly.</strong> </p>
</blockquote>
<p>Consider the two transitions out of the infected symptomatic compartment, for example. Given that a patient is infected and symptomatic, exactly one outcome occurs: they recover (from home) or they go to the hospital. Since one and only one of these outcomes must occur, we must model these two transition variables jointly. Joint distribution derivation details are provided in the next section on transition types.</p>
<p>Each transition variable depends on a "base count" and a "rate" (which both depend on the current state of the system). This decomposition is displayed in the table below. Note that these transitions are for a given location <span class="arithmatex">\(\ell \in \mathcal L\)</span>.</p>
<table>
<thead>
<tr>
<th>Transition</th>
<th>Transition variable</th>
<th>Base count</th>
<th>Rate</th>
</tr>
</thead>
<tbody>
<tr>
<td><span class="arithmatex">\(R\)</span> to <span class="arithmatex">\(S\)</span></td>
<td><span class="arithmatex">\(\tvarloc_{R \rightarrow S, a, r}(\simstate)\)</span></td>
<td><span class="arithmatex">\(R_{a, r}^{(\ell)}(t)\)</span></td>
<td><span class="arithmatex">\(\rateRtoS\)</span></td>
</tr>
<tr>
<td><span class="arithmatex">\(S\)</span> to <span class="arithmatex">\(E\)</span></td>
<td><span class="arithmatex">\(\tvarloc_{S \rightarrow E, a, r}(\simstate)\)</span></td>
<td><span class="arithmatex">\(S_{a, r}^{(\ell)}(t)\)</span></td>
<td><span class="arithmatex">\(\totalforceofinfection\)</span></td>
</tr>
<tr>
<td><span class="arithmatex">\(E\)</span> to <span class="arithmatex">\(IP\)</span></td>
<td><span class="arithmatex">\(\jointtvarloc_{E \rightarrow IP, a, r}(\simstate)\)</span></td>
<td><span class="arithmatex">\(E_{a, r}^{(\ell)}(t)\)</span></td>
<td><span class="arithmatex">\(\rateEtoI (1 - \propIA)\)</span></td>
</tr>
<tr>
<td><span class="arithmatex">\(E\)</span> to <span class="arithmatex">\(IA\)</span></td>
<td><span class="arithmatex">\(\jointtvarloc_{E \rightarrow IA, a, r}(\simstate)\)</span></td>
<td><span class="arithmatex">\(E_{a, r}^{(\ell)}(t)\)</span></td>
<td><span class="arithmatex">\(\rateEtoI \propIA\)</span></td>
</tr>
<tr>
<td><span class="arithmatex">\(IP\)</span> to <span class="arithmatex">\(IS\)</span></td>
<td><span class="arithmatex">\(\tvarloc_{IP \rightarrow IS, a, r}(\simstate)\)</span></td>
<td><span class="arithmatex">\(IP_{a, r}^{(\ell)}(t)\)</span></td>
<td><span class="arithmatex">\(\rateIPtoIS\)</span></td>
</tr>
<tr>
<td><span class="arithmatex">\(IS\)</span> to <span class="arithmatex">\(R\)</span></td>
<td><span class="arithmatex">\(\jointtvarloc_{IS \rightarrow R, a, r}(\simstate)\)</span></td>
<td><span class="arithmatex">\(IS_{a, r}^{(\ell)}(t)\)</span></td>
<td><span class="arithmatex">\((1-\adjustedpropH_{a,r})\gamma\)</span></td>
</tr>
<tr>
<td><span class="arithmatex">\(IS\)</span> to <span class="arithmatex">\(H\)</span></td>
<td><span class="arithmatex">\(\jointtvarloc_{IS \rightarrow H, a, r}(\simstate)\)</span></td>
<td><span class="arithmatex">\(IS_{a, r}^{(\ell)}(t)\)</span></td>
<td><span class="arithmatex">\(\frac{\rateIStoH \adjustedpropH_{a,r} IS\locagerisktime}{1 + \LambdaHHlocagerisktime}\)</span></td>
</tr>
<tr>
<td><span class="arithmatex">\(IA\)</span> to <span class="arithmatex">\(R\)</span></td>
<td><span class="arithmatex">\(\tvarloc_{IA \rightarrow R, a, r}(\simstate)\)</span></td>
<td><span class="arithmatex">\(IA_{a, r}^{(\ell)}(t)\)</span></td>
<td><span class="arithmatex">\(\rateIAtoR IA\locagerisktime\)</span></td>
</tr>
<tr>
<td><span class="arithmatex">\(H\)</span> to <span class="arithmatex">\(R\)</span></td>
<td><span class="arithmatex">\(\jointtvarloc_{H \rightarrow R, a, r}(\simstate)\)</span></td>
<td><span class="arithmatex">\(H_{a, r}^{(\ell)}(t)\)</span></td>
<td><span class="arithmatex">\((1-\adjustedpropD_{a,r})\rateHtoR\)</span></td>
</tr>
<tr>
<td><span class="arithmatex">\(H\)</span> to <span class="arithmatex">\(D\)</span></td>
<td><span class="arithmatex">\(\jointtvarloc_{H \rightarrow D, a, r}(\simstate)\)</span></td>
<td><span class="arithmatex">\(H_{a, r}^{(\ell)}(t)\)</span></td>
<td><span class="arithmatex">\(\frac{\rateHtoD \adjustedpropD_{a,r} H\locagerisktime}{1 + \LambdaHHlocagerisktime}\)</span></td>
</tr>
</tbody>
</table>
<p>The base count and rate of a transition variable parameterize the distribution that defines its realization. </p>
<p>See <a href="../math_transitions/">this page</a> for mathematical formulations of marginal and joint stochastic transitions between compartments. </p>
<h2 id="general-model-discretized-stochastic-implementation">General model: discretized stochastic implementation</h2>
<p>We make the important note that the flu model's discretized stochastic implementation can be generalized to models with different structures. More broadly, we let <span class="arithmatex">\(\boldsymbol{\mathcal C}(t)\)</span> be a model's set of epidemiological compartments, <span class="arithmatex">\(\boldsymbol{\mathcal M}(t)\)</span> its set of aggregate epidemiological metrics, and <span class="arithmatex">\(\boldsymbol{S (t)}\)</span> its set of schedule-dependent (time-dependent) deterministic values. Then the above formulation still holds.</p>
<p>In fact, in our code, we model <span class="arithmatex">\(\boldsymbol{\mathcal C(t)}\)</span> using an <code>Compartment</code> class, <span class="arithmatex">\(\boldsymbol{\mathcal M}(t)\)</span> using an <code>EpiMetric</code> class, and <span class="arithmatex">\(\boldsymbol{\mathcal S(t)}\)</span> using a <code>Schedule</code> class. We handle stochastic transitions using <code>TransitionVariable</code> and <code>TransitionVariableGroup</code> classes. These classes form some of the building blocks of the base model code. </p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.83f73b43.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js"></script>
      
    
  </body>
</html>